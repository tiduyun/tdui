cache:
  paths:
    - node_modules/

variables:
  NODE_ENV: 'production'
  DEVTOOL: 'source-map'
  CI_NEXT_VERSION: 1.4.3

before_script:
  - npm config get registry
  - yarn --production=false

stages:
 - build
 - prerelease
 - release

deployment:
  tags:
    - development
  script:
    - yarn lint
    - yarn build
    - yarn test
  stage: build
  only:
    - devel
    - triggers

prerelease:
  tags:
    - development
  script:
    - yarn lint
    - yarn build
    - yarn test
    - git release-npm -t insiders --next-version ${CI_NEXT_VERSION} -f
  stage: prerelease
  only:
    - master
    - triggers

release:
  tags:
    - development
  script:
    - yarn build
    - git release-npm -t next -f
  stage: release
  only:
    - tags
